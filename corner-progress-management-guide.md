# 코너 진행상황 관리 가이드

코너 네비게이션 시스템의 진행상황을 안전하게 백업, 초기화, 복원하는 방법을 설명합니다.

## 📋 제공되는 스크립트

| 파일명                        | 목적            | 실행 순서         |
| ----------------------------- | --------------- | ----------------- |
| `backup-corner-progress.sql`  | 현재 상태 백업  | 1️⃣ 첫 번째        |
| `reset-corner-progress.sql`   | 진행상황 초기화 | 2️⃣ 두 번째        |
| `restore-corner-progress.sql` | 백업에서 복원   | 3️⃣ 필요시         |
| `sync-scores-migration.sql`   | 점수 동기화     | 📝 점수 불일치 시 |

## 🔄 전체 초기화 절차

### 1단계: 백업 실행 ⚠️ **필수**

```sql
-- backup-corner-progress.sql 실행
-- 현재 모든 진행상황과 점수를 백업 테이블에 저장
```

**결과**: `groups_backup_YYYYMMDD_HHMMSS`, `group_progress_backup_YYYYMMDD_HHMMSS`, `corner_scores_backup_YYYYMMDD_HHMMSS` 테이블 생성

### 2단계: 초기화 실행

```sql
-- reset-corner-progress.sql 실행
-- 선택 1: 완전 초기화 (기본)
-- 선택 2: 진행상황만 초기화 (점수 유지)
-- 선택 3: 특정 조만 초기화
```

### 3단계: 결과 확인

- 코너 네비게이션 페이지에서 모든 조가 0번 코너부터 시작하는지 확인
- 점수가 올바르게 초기화되었는지 확인

## 🛡️ 복원 절차 (문제 발생 시)

### 1단계: 백업 타임스탬프 확인

```sql
-- 사용 가능한 백업 목록 확인
SELECT
    SUBSTRING(table_name FROM '.*_backup_(.*)') as "백업 타임스탬프",
    table_name as "테이블명"
FROM information_schema.tables
WHERE table_schema = 'public'
AND table_name LIKE '%_backup_%'
ORDER BY table_name DESC;
```

### 2단계: 복원 실행

```sql
-- restore-corner-progress.sql에서 타임스탬프 수정 후 실행
BACKUP_TIMESTAMP TEXT := '2024_01_24_14_30_25'; -- 실제 타임스탬프로 변경
```

## 📝 초기화 옵션 상세

### 옵션 1: 완전 초기화 (기본)

- ✅ 모든 코너 점수 기록 삭제
- ✅ 모든 조의 총점을 0으로 초기화
- ✅ 진행상황을 처음부터 시작
- 🎯 **사용 시기**: 새로운 프로그램 시작 시

### 옵션 2: 진행상황만 초기화

- ❌ 코너 점수 기록 삭제 (총점 유지)
- ❌ 총점은 그대로 유지
- ✅ 진행상황만 처음부터 시작
- 🎯 **사용 시기**: 점수는 누적하고 코너만 다시 돌고 싶을 때

### 옵션 3: 특정 조만 초기화

- 선택한 조만 완전 초기화
- 다른 조는 그대로 유지
- 🎯 **사용 시기**: 특정 조에 문제가 있을 때

## ⚠️ 주의사항

### 반드시 지켜야 할 것

1. **백업 먼저**: 초기화 전에 반드시 백업 실행
2. **타임스탬프 기록**: 백업 시 생성된 타임스탬프 기록해두기
3. **권한 확인**: Supabase 관리자 권한으로 실행

### 데이터 손실 위험

- 백업 없이 초기화하면 **모든 데이터 영구 손실**
- 복원 시 잘못된 타임스탬프 사용하면 실패
- 특정 조 초기화 시 조 번호 오타 주의

## 🧪 테스트 절차

### 초기화 후 확인사항

1. **진행상황 확인**

   - [ ] 모든 조가 0번 코너에서 시작
   - [ ] 완료된 코너가 없음
   - [ ] 현재 진행률이 0%

2. **점수 확인** (완전 초기화 시)

   - [ ] 모든 조의 총점이 0점
   - [ ] 코너별 점수 기록이 없음
   - [ ] 전체보기에서 점수 표시 안됨

3. **기능 동작 확인**
   - [ ] 점수 입력 정상 동작
   - [ ] 다음 코너로 진행 정상
   - [ ] 총점 실시간 업데이트

## 💡 자주 묻는 질문

### Q: 백업은 언제까지 보관되나요?

A: 백업 테이블은 수동으로 삭제하기 전까지 영구 보관됩니다. 필요 없는 백업은 정기적으로 삭제해주세요.

### Q: 특정 조만 되돌릴 수 있나요?

A: 현재는 전체 복원만 가능합니다. 특정 조만 복원하려면 백업 데이터를 수동으로 조작해야 합니다.

### Q: 초기화 중에 오류가 발생하면?

A: 즉시 작업을 중단하고 백업에서 복원하세요. 부분적으로 초기화된 상태는 데이터 불일치를 야기할 수 있습니다.

### Q: 점수만 초기화하고 진행상황은 유지할 수 있나요?

A: 가능합니다. `reset-corner-progress.sql`에서 groups 테이블의 score만 0으로 설정하고 나머지는 주석 처리하세요.

## 📞 문제 발생 시 대응

1. **즉시 작업 중단**
2. **백업에서 복원** (`restore-corner-progress.sql`)
3. **문제 원인 파악**
4. **재시도 또는 문의**

---

## 🎯 빠른 참조

```sql
-- 1. 백업
\i backup-corner-progress.sql

-- 2. 완전 초기화
\i reset-corner-progress.sql

-- 3. 복원 (필요시)
-- restore-corner-progress.sql에서 타임스탬프 수정 후
\i restore-corner-progress.sql
```

**중요**: 모든 작업은 Supabase SQL Editor에서 한 번에 하나씩 실행하세요.
